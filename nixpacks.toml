## Top-level Nixpacks configuration to build the backend in `greenmarket-backend`.
## This ensures Railway / Nixpacks will build the backend using Node 18 and
## run the proper install/migrate/start commands from inside the backend folder.

[phases.setup]
packages = ["nodejs-18_x"]

[phases.build]
# run build/install from the backend directory
command = "cd greenmarket-backend && npm ci"

[phases.deploy]
# Ensure dependencies are present in the backend folder at deploy/start time.
# Some build flows copy files after the install step; to be robust we run install
# inside the backend right before starting. This installs production deps only.
command = "cd greenmarket-backend && npm ci --omit=dev && ./start.sh"

[env]
NODE_ENV = "production"
